<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Solo CKPool Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Tailwind CDN for quick styling -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen">
  <div class="max-w-5xl mx-auto px-4 py-8">
    <header class="mb-8">
      <h1 class="text-3xl font-bold mb-2">Solo CKPool Lotto Dashboard</h1>
      <p class="text-slate-400 text-sm">
        Address:
        <span id="address" class="font-mono"></span>
      </p>
      <p class="text-slate-400 text-xs mt-1">
        Data live from <code class="font-mono">solo.ckpool.org</code>
      </p>
    </header>

    <!-- Status / Errors -->
    <div id="status" class="mb-4 text-sm text-slate-300"></div>

    <!-- Main stats -->
    <div id="main-stats" class="grid gap-4 md:grid-cols-3 mb-6"></div>

    <!-- Hashrate cards -->
    <div class="mb-6">
      <h2 class="text-xl font-semibold mb-3">Hashrate</h2>
      <div id="hashrate-cards" class="grid gap-4 md:grid-cols-5"></div>
    </div>

    <!-- Worker stats -->
    <div class="mb-6">
      <h2 class="text-xl font-semibold mb-3">Workers</h2>
      <div id="workers" class="grid gap-4 md:grid-cols-2"></div>
    </div>

    <footer class="mt-10 text-xs text-slate-500">
      Auto-refreshes every 30 seconds. Just a personal lotto-mining toy :)
    </footer>
  </div>

  <script>
    // === CONFIG ===
const BTC_ADDRESS = "bc1qa38m29hprs809kxnddsd03jwlq7p6sru7saw06";
const API_URL = "https://solopooldash.jesf777.workers.dev/ckpool/" + BTC_ADDRESS;

    const REFRESH_INTERVAL_MS = 30000;

    document.getElementById("address").textContent = BTC_ADDRESS;

    function formatTimestamp(ts) {
      if (!ts) return "N/A";
      const d = new Date(ts * 1000);
      return d.toLocaleString();
    }

    function timeSince(ts) {
      if (!ts) return "N/A";
      const seconds = Math.floor(Date.now() / 1000) - ts;
      if (seconds < 60) return `${seconds}s ago`;
      const minutes = Math.floor(seconds / 60);
      if (minutes < 60) return `${minutes}m ago`;
      const hours = Math.floor(minutes / 60);
      if (hours < 24) return `${hours}h ago`;
      const days = Math.floor(hours / 24);
      return `${days}d ago`;
    }

    function createCard(title, value, subtitle = "") {
      const div = document.createElement("div");
      div.className =
        "bg-slate-800/70 border border-slate-700 rounded-xl p-4 flex flex-col gap-1";
      div.innerHTML = `
        <p class="text-xs uppercase tracking-wide text-slate-400">${title}</p>
        <p class="text-xl font-semibold">${value}</p>
        ${
          subtitle
            ? `<p class="text-xs text-slate-400">${subtitle}</p>`
            : ""
        }
      `;
      return div;
    }

    async function loadStats() {
      const statusEl = document.getElementById("status");
      const mainStatsEl = document.getElementById("main-stats");
      const hashrateEl = document.getElementById("hashrate-cards");
      const workersEl = document.getElementById("workers");

      statusEl.textContent = "Loading latest statsâ€¦";

      try {
        const res = await fetch(API_URL);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();

        statusEl.textContent = `Last updated: ${new Date().toLocaleTimeString()}`;

        // Clear containers
        mainStatsEl.innerHTML = "";
        hashrateEl.innerHTML = "";
        workersEl.innerHTML = "";

        // === MAIN STATS ===
        mainStatsEl.appendChild(
          createCard(
            "Best Share (Current Session)",
            data.bestshare.toLocaleString(),
            "Higher = closer to winning block"
          )
        );

        mainStatsEl.appendChild(
          createCard(
            "Best Share (All Time)",
            data.bestever.toLocaleString(),
            ""
          )
        );

        mainStatsEl.appendChild(
          createCard(
            "Total Shares",
            data.shares.toLocaleString(),
            `Workers: ${data.workers}`
          )
        );

        // === HASHRATE CARDS ===
        const hrLabels = {
          hashrate1m: "1 min",
          hashrate5m: "5 min",
          hashrate1hr: "1 hour",
          hashrate1d: "1 day",
          hashrate7d: "7 days",
        };

        Object.entries(hrLabels).forEach(([field, label]) => {
          const val = data[field];
          if (!val) return;
          hashrateEl.appendChild(
            createCard(label, val, "reported by CKPool")
          );
        });

        // === WORKER CARDS ===
        if (Array.isArray(data.worker)) {
          data.worker.forEach((w) => {
            const card = document.createElement("div");
            card.className =
              "bg-slate-800/70 border border-slate-700 rounded-xl p-4 flex flex-col gap-2";

            card.innerHTML = `
              <p class="text-xs uppercase tracking-wide text-slate-400">Worker</p>
              <p class="font-mono text-sm break-all">${w.workername}</p>

              <div class="grid grid-cols-2 gap-2 text-sm mt-2">
                <div>
                  <p class="text-xs text-slate-400">1m</p>
                  <p class="font-semibold">${w.hashrate1m}</p>
                </div>
                <div>
                  <p class="text-xs text-slate-400">5m</p>
                  <p class="font-semibold">${w.hashrate5m}</p>
                </div>
                <div>
                  <p class="text-xs text-slate-400">1h</p>
                  <p class="font-semibold">${w.hashrate1hr}</p>
                </div>
                <div>
                  <p class="text-xs text-slate-400">1d</p>
                  <p class="font-semibold">${w.hashrate1d}</p>
                </div>
              </div>

              <div class="mt-3 text-xs text-slate-400">
                <p>Last share: <span class="text-slate-200">
                  ${timeSince(w.lastshare)} (${formatTimestamp(w.lastshare)})
                </span></p>
                <p>Session shares: <span class="text-slate-200">
                  ${w.shares.toLocaleString()}
                </span></p>
                <p>Best share: <span class="text-slate-200">
                  ${w.bestshare.toLocaleString()}
                </span></p>
              </div>
            `;

            workersEl.appendChild(card);
          });
        }
      } catch (err) {
        console.error(err);
        statusEl.textContent =
          "Error loading stats (maybe CORS or network). Check console.";
      }
    }

    loadStats();
    setInterval(loadStats, REFRESH_INTERVAL_MS);
  </script>
</body>
</html>
